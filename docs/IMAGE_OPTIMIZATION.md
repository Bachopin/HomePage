# å›¾ç‰‡ä¼˜åŒ–ç³»ç»Ÿ

## ğŸ¯ æ¦‚è¿°

æœ¬ç³»ç»Ÿå®ç°äº†å®Œæ•´çš„å›¾ç‰‡ä¼˜åŒ–æµç¨‹ï¼Œé€šè¿‡æ„å»ºæ—¶é¢„å¤„ç† + è¿è¡Œæ—¶æ™ºèƒ½é€‰æ‹©ï¼Œå¤§å¹…æå‡åŠ è½½æ€§èƒ½å¹¶å‡å°‘æœåŠ¡å™¨æµé‡ã€‚

## ğŸ“Š æ€§èƒ½æå‡

- **æ–‡ä»¶å¤§å°**ï¼š1-5MB â†’ 50-200KBï¼ˆå‡å°‘ 86-95%ï¼‰
- **åŠ è½½é€Ÿåº¦**ï¼š3-10ç§’ â†’ 0.3-1ç§’
- **æœåŠ¡å™¨æµé‡**ï¼šå¤§å¹…å‡å°‘ï¼ˆæœ¬åœ°é™æ€æ–‡ä»¶ä¼˜å…ˆï¼‰
- **ç”¨æˆ·ä½“éªŒ**ï¼šå‡ ä¹æ— æ„ŸçŸ¥åŠ è½½

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„

### å›¾ç‰‡åŠ è½½ä¼˜å…ˆçº§

```
1. æœ¬åœ°ä¼˜åŒ–å›¾ç‰‡ï¼ˆæ„å»ºæ—¶ç”Ÿæˆï¼‰â†’ æœ€å¿«ï¼Œé›¶æœåŠ¡å™¨æµé‡
2. å®æ—¶ä»£ç†ä¼˜åŒ–ï¼ˆfallbackï¼‰â†’ æœ‰å†…å­˜ç¼“å­˜ï¼Œå‡å°‘é‡å¤ä¸‹è½½
3. Notion åŸå›¾ï¼ˆæœ€åæ‰‹æ®µï¼‰â†’ ä»…åœ¨å‰ä¸¤è€…éƒ½å¤±è´¥æ—¶ä½¿ç”¨
```

### æ„å»ºæ—¶ä¼˜åŒ–ï¼ˆscripts/optimize-images.jsï¼‰

1. **ä» Notion ä¸‹è½½åŸå›¾**
2. **ç”Ÿæˆå¤šå°ºå¯¸ç‰ˆæœ¬**ï¼š
   - thumbnail: 200px å®½ï¼Œè´¨é‡ 80%
   - medium: 800px å®½ï¼Œè´¨é‡ 88%
   - large: 1200px å®½ï¼Œè´¨é‡ 92%
3. **å¤šæ ¼å¼è¾“å‡º**ï¼šWebPï¼ˆä¼˜å…ˆï¼‰+ JPEGï¼ˆå…¼å®¹ï¼‰
4. **ç”Ÿæˆæ˜ å°„æ–‡ä»¶**ï¼š`image-mapping.json`

### è¿è¡Œæ—¶é€‰æ‹©ï¼ˆsrc/lib/imageService.tsï¼‰

1. **æŸ¥æ‰¾æœ¬åœ°ä¼˜åŒ–å›¾ç‰‡**ï¼šæ ¹æ® Notion URL æŸ¥æ˜ å°„è¡¨
2. **æ™ºèƒ½å°ºå¯¸é€‰æ‹©**ï¼šæ ¹æ®è§†å£å®½åº¦å’Œè®¾å¤‡åƒç´ æ¯”
3. **æ ¼å¼åå•†**ï¼šä¼˜å…ˆ WebPï¼Œå›é€€ JPEG
4. **Fallback ä»£ç†**ï¼šæœ¬åœ°å›¾ç‰‡ä¸å­˜åœ¨æ—¶ä½¿ç”¨å®æ—¶ä»£ç†

### å®æ—¶ä»£ç†ï¼ˆsrc/pages/api/image-proxy.tsï¼‰

- **å†…å­˜ç¼“å­˜**ï¼š1å°æ—¶ TTLï¼Œæœ€å¤š 100 å¼ 
- **HTTP ç¼“å­˜**ï¼š30å¤©æµè§ˆå™¨ç¼“å­˜ï¼Œ7å¤© CDN ç¼“å­˜
- **å®æ—¶ä¼˜åŒ–**ï¼šSharp å¤„ç†ï¼Œæ”¯æŒ WebP/JPEG

## ğŸ”§ ä½¿ç”¨æ–¹æ³•

### 1. å®‰è£…ä¾èµ–

```bash
npm install sharp dotenv
```

### 2. ä¼˜åŒ–å›¾ç‰‡ï¼ˆæ„å»ºå‰è¿è¡Œï¼‰

```bash
# ä¼˜åŒ–æ‰€æœ‰å›¾ç‰‡
npm run optimize-images

# å¼ºåˆ¶é‡æ–°ä¼˜åŒ–
npm run optimize-images:force
```

### 3. æ„å»ºé¡¹ç›®

```bash
npm run build
```

## ğŸ“ æ–‡ä»¶ç»“æ„

```
public/images/optimized/
â”œâ”€â”€ image-mapping.json          # URL æ˜ å°„æ–‡ä»¶
â”œâ”€â”€ item_xxx_thumbnail.webp     # ç¼©ç•¥å›¾ WebP
â”œâ”€â”€ item_xxx_thumbnail.jpeg     # ç¼©ç•¥å›¾ JPEG
â”œâ”€â”€ item_xxx_medium.webp        # ä¸­ç­‰å°ºå¯¸ WebP
â”œâ”€â”€ item_xxx_medium.jpeg        # ä¸­ç­‰å°ºå¯¸ JPEG
â”œâ”€â”€ item_xxx_large.webp         # å¤§å°ºå¯¸ WebP
â””â”€â”€ item_xxx_large.jpeg         # å¤§å°ºå¯¸ JPEG
```

## âš™ï¸ é…ç½®

### å›¾ç‰‡å°ºå¯¸é…ç½®ï¼ˆscripts/optimize-images.jsï¼‰

```javascript
const CONFIG = {
  sizes: {
    thumbnail: { width: 200, quality: 80 },
    medium: { width: 800, quality: 88 },
    large: { width: 1200, quality: 92 },
  },
  formats: ['webp', 'jpeg'],
  concurrency: 5,
};
```

### è¿è¡Œæ—¶é€‰æ‹©é€»è¾‘ï¼ˆsrc/lib/imageService.tsï¼‰

```typescript
function selectImageSize(viewportWidth: number, devicePixelRatio: number) {
  const effectiveWidth = viewportWidth * devicePixelRatio;
  
  if (effectiveWidth <= 400) return 'thumbnail';
  if (effectiveWidth <= 1000) return 'medium';
  return 'large';
}
```

## ğŸ”„ å·¥ä½œæµç¨‹

### å¼€å‘ç¯å¢ƒ

```bash
# é¦–æ¬¡è¿è¡Œä¼˜åŒ–è„šæœ¬
npm run optimize-images

# å¯åŠ¨å¼€å‘æœåŠ¡å™¨
npm run dev
```

### ç”Ÿäº§ç¯å¢ƒ

```bash
# 1. ä¼˜åŒ–å›¾ç‰‡
npm run optimize-images

# 2. æ„å»ºé¡¹ç›®
npm run build

# 3. å¯åŠ¨ç”Ÿäº§æœåŠ¡å™¨
npm start
```

### æ–°å¢å›¾ç‰‡å

```bash
# é‡æ–°è¿è¡Œä¼˜åŒ–è„šæœ¬ï¼ˆå¢é‡å¤„ç†ï¼‰
npm run optimize-images
```

## ğŸš¨ æ³¨æ„äº‹é¡¹

1. **Notion URL è¿‡æœŸ**ï¼šNotion å›¾ç‰‡ URL æœ‰æ—¶æ•ˆæ€§ï¼Œæœ¬åœ°ä¼˜åŒ–å›¾ç‰‡ä¸å—å½±å“
2. **æ„å»ºæ—¶é—´**ï¼šé¦–æ¬¡ä¼˜åŒ–å¯èƒ½éœ€è¦è¾ƒé•¿æ—¶é—´ï¼ˆå–å†³äºå›¾ç‰‡æ•°é‡ï¼‰
3. **å­˜å‚¨ç©ºé—´**ï¼šä¼˜åŒ–åçš„å›¾ç‰‡ä¼šå ç”¨é¢å¤–ç©ºé—´ï¼ˆçº¦ä¸ºåŸå›¾çš„ 10-15%ï¼‰
4. **æ˜ å°„æ›´æ–°**ï¼šæ–°å¢ Notion å›¾ç‰‡åéœ€é‡æ–°è¿è¡Œä¼˜åŒ–è„šæœ¬

## ğŸ” æ•…éšœæ’é™¤

### å›¾ç‰‡ä¼˜åŒ–å¤±è´¥

```bash
# æ£€æŸ¥ Sharp å®‰è£…
npm list sharp

# é‡æ–°å®‰è£… Sharp
npm uninstall sharp && npm install sharp

# æ£€æŸ¥ç¯å¢ƒå˜é‡
echo $NOTION_API_KEY
echo $NOTION_DATABASE_ID
```

### å›¾ç‰‡ä¸æ˜¾ç¤º

1. æ£€æŸ¥ `public/images/optimized/image-mapping.json` æ˜¯å¦å­˜åœ¨
2. æ£€æŸ¥æ˜ å°„æ–‡ä»¶ä¸­æ˜¯å¦åŒ…å«å¯¹åº”çš„ Notion URL
3. æŸ¥çœ‹æµè§ˆå™¨æ§åˆ¶å°ç½‘ç»œè¯·æ±‚

### åŠ è½½ä»ç„¶æ…¢

1. ç¡®è®¤æœ¬åœ°ä¼˜åŒ–å›¾ç‰‡å·²ç”Ÿæˆ
2. æ£€æŸ¥æµè§ˆå™¨ Network é¢æ¿ï¼Œç¡®è®¤è¯·æ±‚çš„æ˜¯æœ¬åœ°æ–‡ä»¶è€Œéä»£ç†
3. æ¸…é™¤æµè§ˆå™¨ç¼“å­˜åé‡è¯•
